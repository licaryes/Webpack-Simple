import"../assets/styles/main.scss";import{el,setChildren}from"redom";import Inputmask from"inputmask";const CardInfo=require("card-info"),cardValidator=require("card-validator"),validator=require("validator"),{getDaysInMonth}=require("date-fns");import question from"../assets/images/icons8-вопросительный-знак-52.png";import mir from"../assets/images/brands-logos/mir-white.svg";import visa from"../assets/images/brands-logos/visa-white.svg";import mastercard from"../assets/images/brands-logos/master-card-white.svg";import sberbank from"../assets/images/banks-logos/ru-sberbank.svg";const numberInput=document.getElementById("number"),cvvInput=document.getElementById("cvv"),yearInput=document.getElementById("year"),monthInput=document.getElementById("month"),emailInput=document.getElementById("email"),now=new Date;function check_number(e){return e.key<10&&e.key>=0&&" "!==e.key||"Backspace"===e.key}function check_validation(){const e=new Date(Number("20"+yearInput.value),monthInput.value-1,getDaysInMonth(new Date(Number("20"+yearInput.value),monthInput.value-1)));cardValidator.number(numberInput.value).isValid&&3===cvvInput.value.length&&now<=e&&validator.isEmail(emailInput.value)?document.getElementById("buy").disabled=!1:document.getElementById("buy").disabled=!0}yearInput.addEventListener("keydown",(e=>{e.preventDefault(),check_number(e)&&("Backspace"===e.key?e.target.value=e.target.value.slice(0,-1):e.target.value.length<2&&(now.getFullYear().toString().slice(2)<e.target.value+e.key&&monthInput.value<now.getMonth()+1||now.getFullYear().toString().slice(2,3)<=(e.target.value+e.key).toString().slice(0,1)&&0===e.target.value.length||now.getFullYear().toString().slice(3)<=(e.target.value+e.key).toString().slice(1)&&monthInput.value>=now.getMonth()+1)&&(e.target.value+=e.key),check_validation())})),monthInput.addEventListener("keydown",(e=>{e.preventDefault(),check_number(e)&&("Backspace"===e.key?e.target.value=e.target.value.slice(0,-1):e.target.value.length<2&&(yearInput.value===now.getFullYear().toString().slice(2)&&e.target.value+e.key<=12&&(e.target.value+e.key>=now.getMonth()+1||0===e.target.value.length&&"1"===e.key)||e.target.value+e.key<=12&&e.target.value+e.key>0&&yearInput.value!==now.getFullYear().toString().slice(2))&&(e.target.value+=e.key),check_validation())})),cvvInput.addEventListener("keydown",(e=>{e.preventDefault(),check_number(e)&&("Backspace"===e.key?e.target.value=e.target.value.slice(0,-1):e.target.value.length<3&&(e.target.value+=e.key),check_validation())})),numberInput.addEventListener("keydown",(e=>{if(e.preventDefault(),check_number(e)){const t=e.target.value.match(/\d/g)||[];"Backspace"===e.key?t.pop():t.length<16&&t.push(e.key);let a="";for(let e=0;e<t.length;e++)a+=t[e];if(Inputmask({mask:"9999 9999 9999 9999"}).mask(e.target),e.target.value=a,16===t.length&&cardValidator.number(a).isValid){const e=new CardInfo(a);switch(console.log(e),e.brandName){case"MIR":setChildren(document.getElementById("brand"),el("img",{src:mir}));break;case"Visa":setChildren(document.getElementById("brand"),el("img",{src:visa}));break;case"MasterCard":setChildren(document.getElementById("brand"),el("img",{src:mastercard}));break;default:setChildren(document.getElementById("brand"),el("img",{src:question}))}document.getElementById("buy").disabled=!1}else setChildren(document.getElementById("brand"),el("p"));check_validation()}})),emailInput.addEventListener("keyup",(e=>{check_validation()}));